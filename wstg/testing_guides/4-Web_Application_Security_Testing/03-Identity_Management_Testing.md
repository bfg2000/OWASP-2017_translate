### 03-Identity_Management_Testing - Тестирование управлением идентификации

### 4.03.01 Test Role Definitions - Описание тестовых ролей

<ins>Резюме</ins><br>
Приложения имеют несколько типов функций и служб, и для них требуются разрешения на доступ в зависимости от потребностей пользователя. 
Этим пользователем может быть:
- администратор, где он управляет функциями приложения.
- аудитор, где он проверяет транзакции приложения и предоставляют подробный отчет.
- инженер службы поддержки, где они помогают клиентам отлаживать и устранять проблемы в их учетных записях.
- клиент, где они взаимодействуют с приложением и получают выгоду от его услуг.

Для обработки этих видов использования и любых других вариантов использования этого приложения устанавливаются определения ролей (более известные как RBAC). На основе этих ролей пользователь может выполнить требуемую задачу.

<ins>Задачи теста</ins>
Определите и задокументируйте роли, используемые приложением.
Попытайтесь переключиться, изменить или получить доступ к другой роли.
Проверьте степень детализации ролей и потребности в предоставленных разрешениях.

<ins>Как протестировать</ins>
Идентификация ролей
Тестировщик должен начать с определения тестируемых ролей приложения любым из следующих методов:
- Документация по применению.
- Рекомендации разработчиков или администраторов приложения.
- Комментарии к приложению.

Возможные роли:
- переменная cookie (например, role = admin, isAdmin = True)
- переменная аккаунта (например, роль: менеджер)
- скрытые каталоги или файлы (например, /admin, /mod, /backups)
- переключение на хорошо известных пользователей (например, администратор, резервные копии и т. д.)
- переключение на доступные роли

После определения возможных векторов атаки тестировщику необходимо протестировать и подтвердить, что они могут получить доступ к доступным ролям.
Некоторые приложения определяют роли пользователя при создании, посредством строгих проверок и политик или путем обеспечения надлежащей защиты роли пользователя с помощью подписи, созданной серверной частью. Обнаружение того, что роли существуют, не означает, что они уязвимы.

<ins>Просмотр разрешений ролей</ins>
После получения доступа к ролям в системе тестировщик должен понимать разрешения, предоставленные каждой роли.
- Инженер службы поддержки не должен иметь возможность выполнять административные функции, управлять резервным копированием или проводить какие-либо транзакции вместо пользователя.
- Администратор не должен иметь полных полномочий в системе. Чувствительные функции администратора должны основываться на принципе производителя и проверки или использовать MFA, чтобы гарантировать, что администратор проводит транзакцию. Ярким примером этого стал инцидент с Twitter в 2020 году.

<ins>инструменты</ins>
Вышеупомянутые тесты могут проводиться без использования каких-либо инструментов, кроме того, который используется для доступа к системе.

Чтобы упростить задачу и сделать ее более документированной, можно использовать:
- Расширение Burp's Autorize
- Надстройка ZAP для тестирования контроля доступа


### 4.03.02 Test User Registration Process

<ins>Резюме</ins>
Некоторые веб-сайты предлагают процесс регистрации пользователей, который автоматизирует (или полуавтоматизирует) предоставление пользователям доступа к системе. Требования к идентификации для доступа варьируются от положительной идентификации до отсутствия вообще, в зависимости от требований безопасности системы. Многие общедоступные приложения полностью автоматизируют процесс регистрации и инициализации, поскольку размер пользовательской базы делает невозможным управление вручную. Однако многие корпоративные приложения инициализируют пользователей вручную, поэтому этот тестовый пример может не применяться.

<ins>Задачи теста</ins>
Убедитесь, что требования к идентификации для регистрации пользователей соответствуют бизнес-требованиям и требованиям безопасности.
Подтвердите процесс регистрации.

<ins>Как протестировать</ins>
Убедитесь, что требования к идентификации для регистрации пользователей соответствуют бизнес-требованиям и требованиям безопасности:
- Кто-нибудь может зарегистрироваться для доступа?
- Проверяются ли регистрации человеком перед инициализацией или они предоставляются автоматически при соблюдении критериев?
- Может ли одно и то же лицо или личность регистрироваться несколько раз?
- Могут ли пользователи регистрироваться для разных ролей или разрешений?
- Какое удостоверение личности требуется для успешной регистрации?
- Проверяются ли зарегистрированные личности?

Подтвердите процесс регистрации:
- Можно ли легко подделать или подделать идентификационную информацию?
- Можно ли манипулировать обменом идентификационной информацией во время регистрации?

<ins>ПРИМЕР</ins>
В приведенном ниже примере WordPress единственное требование к идентификации - это адрес электронной почты, доступный регистранту.
![Image alt](https://github.com/bfg2000/OWASP-2017_translate/blob/main/wstg/testing_guides/4-Web_Application_Security_Testing/images/4-3-2-1.jpg)


### 4.03.03 Test Account Provisioning Process - Тестирование создания учетной записи

<ins>Резюме</ins>
Созлание учетных записей дает злоумышленнику возможность создать действительную учетную запись без применения надлежащего процесса идентификации и авторизации.

<ins>Цели теста</ins>
- Проверить, какие учетные записи могут предоставлять другие учетные записи и какого типа.

<ins>Как проверить</ins>
Определите, какие роли могут предоставлять пользователей и какие учетные записи они могут предоставлять.

- Есть ли проверка, проверка и авторизация запросов на обеспечение?
- Есть ли проверка, проверка и авторизация запросов на деинициализацию?
- Может ли администратор подготовить других администраторов или только пользователей?
- Может ли администратор или другой пользователь предоставить учетные записи с более высокими привилегиями, чем их собственные?
- Может ли администратор или пользователь деинициализировать себя?
- Как управляются файлы или ресурсы, принадлежащие исключенному пользователю? Они удалены? Доступ передан?

<ins>Пример</ins>
В WordPress для инициализации пользователя требуются только имя пользователя и адрес электронной почты, как показано ниже:

![Добавление пользователя WordPress] (https://github.com/bfg2000/OWASP-2017_translate/blob/main/wstg/testing_guides/4-Web_Application_Security_Testing/images/Wordpress_useradd.png)

Для деинициализации пользователей требуется, чтобы администратор выбрал пользователей, которые будут деинициализированы, выберите «Удалить» в раскрывающемся меню (обведено) и затем примените это действие. Затем администратору предоставляется диалоговое окно с вопросом, что делать с сообщениями пользователя (удалить или передать их).

![Аутентификация и пользователи WordPress] (https://github.com/bfg2000/OWASP-2017_translate/blob/main/wstg/testing_guides/4-Web_Application_Security_Testing/images/Wordpress_authandusers.png)


<ins>Инструменты</ins>

Хотя наиболее тщательный и точный подход к выполнению этого теста - проводить его вручную, инструменты прокси-сервера HTTP также могут быть полезны.



### 4.03.04 Testing for Account Enumeration and Guessable User Account
### Тестирование перечисления учетных записей и предполагаемой учетной записи пользователя

<ins>Резюме</ins>
Задача этого теста - проверить, возможно ли собрать набор действительных имен пользователей, взаимодействуя с механизмом аутентификации приложения. Этот тест будет полезен для тестирования методом грубой силы, в котором тестировщик проверяет, возможно ли, учитывая действительное имя пользователя, найти соответствующий пароль.

Часто веб-приложения показывают, когда имя пользователя существует в системе, либо в результате неправильной конфигурации, либо в результате дизайнерского решения. Например, иногда, когда мы отправляем неправильные учетные данные, мы получаем сообщение о том, что либо имя пользователя присутствует в системе, либо предоставленный пароль неверен. Полученная информация может быть использована злоумышленником для получения списка пользователей системы. Эта информация может быть использована для атаки на веб-приложение, например, посредством грубой силы или атаки с использованием имени пользователя и пароля по умолчанию.
Тестировщик должен взаимодействовать с механизмом аутентификации приложения, чтобы понять, заставляет ли отправка определенных запросов приложение отвечать разными способами. Эта проблема возникает из-за того, что информация, выпущенная веб-приложением или веб-сервером, когда пользователь предоставляет действительное имя пользователя, отличается от информации, полученной при использовании недопустимого.
В некоторых случаях получается сообщение, которое показывает, неверны ли предоставленные учетные данные из-за использования недопустимого имени пользователя или недопустимого пароля. Иногда тестировщики могут перечислить существующих пользователей, отправив имя пользователя и пустой пароль.

<ins>Цели теста</ins>
- Изучите процессы, относящиеся к идентификации пользователя (например: регистрация, вход в систему и т.д.).
- По возможности перечисляйте пользователей с помощью анализа ответов.

<ins>Как проверить</ins>
При тестировании методом «черного ящика» тестировщик ничего не знает о конкретном приложении, имени пользователя, логике приложения, сообщениях об ошибках на странице входа в систему или средствах восстановления пароля. Если приложение уязвимо, тестировщик получает ответное сообщение, в котором прямо или косвенно раскрывается некоторая информация, полезная для перечисления пользователей.

<ins>1 - Сообщение HTTP-ответа</ins>

<ins>a)</ins> Проверка действительного пользователя / правильного пароля
- Запишите ответ сервера при отправке действительного идентификатора пользователя и действительного пароля.
- Используя веб-прокси, обратите внимание на информацию, полученную в результате этой успешной аутентификации (ответ HTTP 200, длина ответа).

<ins>б)</ins> Проверка на действительного пользователя с неправильным паролем
Теперь тестировщик должен попытаться вставить действительный идентификатор пользователя и неправильный пароль и записать сообщение об ошибке, созданное приложением.
 В браузере должно отображаться сообщение, подобное следующему:

![Ошибка аутентификации] (https://github.com/bfg2000/OWASP-2017_translate/blob/main/wstg/testing_guides/4-Web_Application_Security_Testing/images/AuthenticationFailed.png)

или что-то вроде:

![Конфигурация не найдена] (https://github.com/bfg2000/OWASP-2017_translate/blob/main/wstg/testing_guides/4-Web_Application_Security_Testing/images/NoConfFound.jpg)

против любого сообщения, которое раскрывает существование пользователя, например, сообщение, подобное:
```
Вход для пользователя foo: неверный пароль
```

Используя веб-прокси, обратите внимание на информацию, полученную в результате этой неудачной попытки аутентификации (ответ HTTP 200, длина ответа).

<ins>в)</ins> Тестирование несуществующего имени пользователя
Теперь тестировщик должен попытаться вставить неверный идентификатор пользователя и неправильный пароль и записать ответ сервера (тестировщик должен быть уверен, что имя пользователя недействительно в приложении). Запишите сообщение об ошибке и ответ сервера.
> Если тестировщик вводит несуществующий идентификатор пользователя, он может получить сообщение, подобное следующему:

![Этот пользователь не активен](/https://github.com/bfg2000/OWASP-2017_translate/blob/main/wstg/testing_guides/4-Web_Application_Security_Testing/images/Userisnotactive.png)
 * Рисунок 4.3.4-3: Этот пользователь не активен *

или сообщение, подобное следующему:
```
Ошибка входа для пользователя foo: неверная учетная запись
```

Обычно приложение должно отвечать одним и тем же сообщением об ошибке и длиной на разные неправильные запросы. Если ответы не совпадают, тестировщик должен исследовать и найти ключ, который создает разницу между двумя ответами. Например:
- Запрос клиента: действующий пользователь / неверный пароль
- Ответ сервера: неверный пароль

- Запрос клиента: неверный пользователь / неверный пароль
- Ответ сервера: «Пользователь не распознан»

Приведенные выше ответы позволяют клиенту понять, что для первого запроса у него есть действительное имя пользователя. Таким образом, они могут взаимодействовать с приложением, запрашивая набор возможных идентификаторов пользователей и наблюдая за ответом.

Глядя на второй ответ сервера, тестировщики точно так же понимают, что у них нет действительного имени пользователя. Таким образом, они могут взаимодействовать таким же образом и создавать список действительных идентификаторов пользователей, просматривая ответы сервера.

Другие способы перечисления пользователей
Тестировщики могут перечислять пользователей несколькими способами, например:

<ins>2 - Анализ кода ошибки, полученного на страницах входа</ins>

Некоторые веб-приложения выпускают определенный код ошибки или сообщение, которое мы можем проанализировать.

<ins>а)</ins> Анализ URL-адресов и URL-адресов Перенаправление
Например:
```
http: //www.foo.com/err.jsp? User = baduser & Error = 0
http: //www.foo.com/err.jsp? User = gooduser & Error = 2
```

Как видно выше,когда тестировщик предоставляет идентификатор пользователя и пароль веб-приложению, он видит сообщение, указывающее, что в URL-адресе произошла ошибка. В первом случае они предоставили неверный идентификатор пользователя и неверный пароль. Во втором - хороший идентификатор пользователя и плохой пароль, чтобы они могли идентифицировать действительный идентификатор пользователя.

<ins>б)</ins> Проверка URI
Иногда веб-сервер по-разному отвечает, получает он запрос на существующий каталог или нет. Например, на некоторых порталах каждый пользователь связан с каталогом. Если тестировщики попытаются получить доступ к существующему каталогу, они могут получить ошибку веб-сервера.
Некоторые из распространенных ошибок, получаемых от веб-серверов:
- 403 Запрещенный код ошибки
- 404 Не найден код ошибки

Пример:
```
http: // www.foo.com / account1` - получаем от веб-сервера: 403 Forbidden
http: // www.foo.com / account2` - получаем от веб-сервера: 404 файл не найден
```

В первом случае пользователь существует, но тестировщик не может просматривать веб-страницу, во втором случае вместо этого пользователь «account2» не существует. Собирая эту информацию, тестировщики могут перечислять пользователей.

<ins>в)</ins> Анализ заголовков веб-страниц
Тестировщики могут получить полезную информацию о заголовке веб-страницы, где они могут получить конкретный код ошибки или сообщения, которые показывают, связаны ли проблемы с именем пользователя или паролем.

Например, если пользователь не может пройти аутентификацию в приложении и получает веб-страницу, заголовок которой похож на:
```
Недействительный пользователь
Недействительная аутентификация
```

<ins>г)</ins> Анализ сообщения, полученного от средства восстановления
Когда мы используем средство восстановления (например, функцию забытого пароля), уязвимое приложение может вернуть сообщение, которое показывает, существует ли имя пользователя или нет.

Например, сообщения, похожие на следующие:
```
Неверное имя пользователя: адрес электронной почты недействителен или указанный пользователь не найден.
Действительное имя пользователя: ваш пароль был успешно отправлен на адрес электронной почты, на который вы зарегистрировались.
```

<ins>д)</ins> Дружественное сообщение об ошибке 404
Когда мы запрашиваем пользователя в несуществующем каталоге, мы не всегда получаем код ошибки 404. Вместо этого мы можем получить «200 ok» с изображением, в этом случае мы можем предположить, что когда мы получаем конкретное изображение, пользователь не существует. Эта логика может быть применена к ответу другого веб-сервера; Хитрость заключается в хорошем анализе сообщений веб-сервера и веб-приложений.

<ins>е)</ins> Анализ времени отклика
Помимо просмотра содержания ответов, следует также учитывать время, которое потребуется на ответ. В частности, если запрос вызывает взаимодействие с внешней службой (например, отправка электронного письма с забытым паролем), это может добавить несколько сотен миллисекунд к ответу, что может быть использовано для определения того, действителен ли запрошенный пользователь.

<ins>ж)</ins> Гадание пользователей
В некоторых случаях идентификаторы пользователей создаются с помощью определенных политик администратора или компании. Например, мы можем просмотреть пользователя с идентификатором пользователя, созданным в последовательном порядке:
```
html
CN000100
CN000101
...
```

Иногда имена пользователей создаются с псевдонимом REALM, а затем с последовательными номерами:
- R1001 - пользователь 001 для REALM1
- R2001 - пользователь 001 для REALM2

В приведенном выше примере мы можем создать простые сценарии оболочки, которые составляют идентификаторы пользователей и отправляют запрос с помощью такого инструмента, как wget, для автоматизации веб-запроса для определения действительных идентификаторов пользователей. Для создания скрипта мы также можем использовать Perl и curl.
<ins>Другие возможности:</ins> - идентификаторы пользователей, связанные с номерами кредитных карт или, в общем, номерами с шаблоном. - идентификаторы пользователей, связанные с настоящими именами, например Если у Фредди Меркьюри идентификатор пользователя «fmercury», то вы можете предположить, что у Роджера Тейлора идентификатор пользователя «rtaylor».
Опять же, мы можем угадать имя пользователя из информации, полученной из запроса LDAP или из сбора информации Google, например, из определенного домена. Google может помочь найти пользователей домена с помощью конкретных запросов или с помощью простого сценария или инструмента оболочки.
Перечисляя учетные записи пользователей, вы рискуете заблокировать учетные записи после заранее определенного количества неудачных попыток (на основе политики приложения). Кроме того, иногда ваш IP-адрес может быть заблокирован динамическими правилами в брандмауэре приложений или в системе предотвращения вторжений.

<ins>Тестирование серого ящика</ins>

<ins>Тестирование сообщений об ошибках аутентификации</ins>

Убедитесь, что приложение одинаково отвечает на все клиентские запросы, приводящие к неудачной аутентификации. Для этой проблемы тестирование черного ящика и тестирование серого ящика имеют одинаковую концепцию, основанную на анализе сообщений или кодов ошибок, полученных из веб-приложения.

Приложение должно одинаково отвечать на каждую неудачную попытку аутентификации.
Например: * Представленные учетные данные недействительны *

<ins>Инструменты</ins>

- [OWASP Zed Attack Proxy (ZAP)] (https://www.zaproxy.org)
- [завиток] (https://curl.haxx.se/)
- [PERL] (https://www.perl.org)

<ins>Исправление</ins>
- Убедитесь, что приложение возвращает минусы общие сообщения об ошибках istent в ответ на неверное имя учетной записи, пароль или другие учетные данные пользователя, введенные во время входа в систему.
- Убедитесь, что системные учетные записи по умолчанию и тестовые учетные записи удалены, прежде чем запускать систему в производство (или предоставлять ее в ненадежной сети).


### 4.3.5 Testing for Weak or Unenforced Username Policy
### Проверка на слабую или невыполненную политику имени пользователя

<ins> Цели теста</ins>
- Определите, создает ли согласованная структура имени учетной записи уязвимость приложения для перечисления учетных записей.
- Определите, разрешают ли сообщения об ошибках приложения перечисление учетных записей.

<ins>Как тестировать</ins>
- Определите структуру имен учетных записей.
- Оцените реакцию приложения на допустимые и недопустимые имена учетных записей.
- Используйте разные ответы на допустимые и недопустимые имена учетных записей, чтобы перечислить допустимые имена учетных записей.
- Используйте словари имен учетных записей для перечисления действительных имен учетных записей.

<ins>Исправление</ins>
Убедитесь, что приложение возвращает согласованные общие сообщения об ошибках в ответ на неверное имя учетной записи, пароль или другие учетные данные пользователя, введенные во время входа в систему.

